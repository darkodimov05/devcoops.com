I"{<p>In the previous posts, i’ve covered the creation of MySQL and MariaDB using the <code class="language-plaintext highlighter-rouge">Azure Database</code> service. Today, i’ll write about PostgreSQL, the last one Azure’s Database service to offer.<br />
PostgreSQL is a free and open-source relational database management system. It’s a general-purpose RDBMS, designed to be extensible, and got advanced features like the other enterprise database management systems.<br />
The PostgreSQL database creation procedure is almost the same as the MySQL and MariaDB.</p>

<h2 id="prerequisites">Prerequisites</h2>
<ul>
  <li>Azure account</li>
</ul>

<h2 id="create-an-azure-postgresql-database">Create an Azure PostgreSQL Database</h2>
<p><strong>Step 1</strong>. Open <em>Terminal</em> and login to the Azure Portal:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>az login
</code></pre></div></div>
<p>It will open a new window using the default browser where you will be prompted for email and password.</p>

<p><strong>Step 2</strong>. Create a resource group:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>az group create <span class="nt">--name</span> <span class="s2">"postgresql-rg"</span> <span class="nt">--location</span> westeurope
</code></pre></div></div>

<p><strong>Step 3</strong>. Create a PostgreSQL server:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>az postgres server create <span class="nt">--name</span> <span class="s2">"devcoopsdbserver"</span> <span class="nt">--resource-group</span> <span class="s2">"postgresql-rg"</span> <span class="nt">--location</span> westeurope <span class="nt">--admin-user</span> <span class="s2">"devcoops"</span> <span class="nt">--admin-password</span> <span class="s2">"&lt;insert_password_here&gt;"</span> <span class="nt">--sku-name</span> <span class="s2">"B_Gen5_1"</span>
</code></pre></div></div>
<p>Parameters:</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">--name</code>: PostgreSQL server name.</li>
  <li><code class="language-plaintext highlighter-rouge">--resource-group</code>: resource group where the postgresql database server belongs to.</li>
  <li><code class="language-plaintext highlighter-rouge">--location</code>: filter the result to show the connectionString only.</li>
  <li><code class="language-plaintext highlighter-rouge">--admin-user</code>: server admin username.</li>
  <li><code class="language-plaintext highlighter-rouge">--admin-password</code>: server admin password.</li>
  <li><code class="language-plaintext highlighter-rouge">--sku-name</code>: SKU name in the following format: {pricing tier}<em>{compute generation}</em>{vCores}. More about the MariaDB <a href="https://docs.microsoft.com/en-us/azure/postgresql/concepts-pricing-tiers" target="_blank">pricing tiers</a>.</li>
</ul>

<p><strong>Step 4</strong>. Get the connection information:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>az postgres server show <span class="nt">--name</span> <span class="s2">"devcoopsdbserver"</span> <span class="nt">--resource-group</span> <span class="s2">"postgresql-rg"</span>
</code></pre></div></div>
<p>The JSON output should look for the <strong>administratorLogin</strong> and <strong>fullyQualifiedDomainName</strong> parameters. For example:<br />
<img src="/assets/images/screenshots/screenshot33.png" alt="Azure Database PostgreSQL connection string" /></p>

<p><strong>Note</strong>: Now that we have the connection information, we could create a database either by:</p>
<ol>
  <li>Connect to the server using the PostgreSQL cli, or the pgAdmin GUI tool and create a database:
    <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">CREATE DATABASE mydb;</span><span class="w">
</span></code></pre></div>    </div>
  </li>
  <li>Using the Azure CLI.</li>
</ol>

<p><strong>Step 5</strong>. Create a PostgreSQL database using Azure CLI:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>az postgres db create <span class="nt">--name</span> <span class="s2">"mydb"</span> <span class="nt">--resource-group</span> <span class="s2">"postgresql-rg"</span> <span class="nt">--server-name</span> <span class="s2">"devcoopsdbserver"</span> 
</code></pre></div></div>
<p>Parameters:</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">--name</code>: PostgreSQL database name.</li>
  <li><code class="language-plaintext highlighter-rouge">--resource-group</code>: resource group where the database belongs to.</li>
  <li><code class="language-plaintext highlighter-rouge">--server</code>: PostgreSQL server name.</li>
</ul>

<p><strong>Step 6</strong>. Test the connection:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>psql <span class="nt">--host</span><span class="o">=</span>devcoopsdbserver.postgres.database.azure.com <span class="nt">--port</span><span class="o">=</span>5432 <span class="nt">--username</span><span class="o">=</span>devcoops@devcoopsdbserver <span class="nt">--dbname</span><span class="o">=</span>mydb 
</code></pre></div></div>

<h2 id="cleanup">Cleanup</h2>
<p><strong>Step 7</strong>. Delete the PostgreSQL database:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>az postgres db delete <span class="nt">--name</span> <span class="s2">"mydb"</span> <span class="nt">--resource-group</span> <span class="s2">"postgresql-rg"</span> <span class="nt">--server-name</span> <span class="s2">"devcoopsdbserver"</span>
</code></pre></div></div>

<p><strong>Step 8</strong>. Delete the PostgreSQL server:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>az postgres server delete <span class="nt">--name</span> <span class="s2">"mydb"</span> <span class="nt">--resource-group</span> <span class="s2">"postgresql-rg"</span>
</code></pre></div></div>

<p><strong>Step 9</strong>. Delete the resource group:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>az group delete <span class="nt">--name</span> <span class="s2">"postgresql-rg"</span>
</code></pre></div></div>

<p>More about <a href="https://docs.microsoft.com/en-us/azure/postgresql/quickstart-create-server-database-azure-cli" target="_blank">Azure Database for PostgreSQL using Azure CLI</a>.</p>

<h2 id="conclusion">Conclusion</h2>
<p>This is just a plain example, that shows how easily you can create a PostgreSQL server and database in no time. It can be quite useful for development. If you have trouble connecting to the PostgreSQL server, please check the following:</p>
<ol>
  <li>Configure firewall rules using the command:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>az postgres server firewall-rule create  <span class="nt">--server</span> <span class="s2">"devcoopsdbserver"</span>  <span class="nt">--resource-group</span> <span class="s2">"postgresql-rg"</span> <span class="nt">--name</span> AllowMyIP <span class="nt">--start-ip-address</span> <span class="s2">"&lt;insert_start_ip_here&gt;"</span> <span class="nt">--end-ip-address</span> <span class="s2">"&lt;insert_end_ip_here&gt;"</span>
</code></pre></div>    </div>
  </li>
  <li>Disable enforcing SSL (it’s enabled by default on the PostgreSQL server).
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>az postgres server update  <span class="nt">--name</span> <span class="s2">"devcoopsbdbserver"</span> <span class="nt">--resource-group</span> <span class="s2">"postgresql-rg"</span> <span class="nt">--ssl-enforcement</span> Disabled
</code></pre></div>    </div>
  </li>
  <li>Connection string typo.</li>
</ol>
:ET