I"ý<p>When we mention public cloud and devops, we often think of Amazon Web Services, Microsoftâ€™s Azure or Google Cloud Platform. As AWS becomes dominant public cloud leader through the years, many corporations and startups started to migrate their on-premises infrastructure to the cloud, especially AWS. This often leads to public cloud vendor lock-in. But, if someday you decide to migrate to Azure, you might face up many challenges. For example, if you want to migrate your S3 bucket to Azure Storage, you will have to write your own custom scripts or even come up with your own custom tools. This adds to complexity. So, in todayâ€™s blog, we are going to talk about how to migrate/copy AWS S3 buckets to Azure Blob Storage using a tool called <strong>azcopy</strong> that will help you move your AWS S3 buckets to the Azure storage service.</p>

<h2 id="what-is-azcopy">What is AzCopy</h2>
<p><strong>AzCopy</strong> is a command-line utility that can copy data to or from an Azure storage accounts. The current version is AzCopy v10.2.1</p>

<p><a href="https://github.com/Azure/azure-storage-azcopy" target="_blank">AzCopy repository</a></p>

<h2 id="prerequisites">Prerequisites</h2>
<ul>
  <li>Azure account</li>
  <li>Azure storage account</li>
  <li>AWS account</li>
  <li>AWS S3 bucket</li>
</ul>

<h2 id="download-and-install-azcopy">Download and Install azcopy</h2>
<p><strong>Step 1</strong>. Download <strong>azcopy</strong> as a zip/tar from Microsoft:</p>
<ul>
  <li><a href="https://aka.ms/downloadazcopy-v10-windows">Windows</a></li>
  <li><a href="https://aka.ms/downloadazcopy-v10-linux">Linux</a></li>
  <li><a href="https://aka.ms/downloadazcopy-v10-mac">MacOS</a></li>
</ul>

<p><strong>Step 2</strong>. Install <strong>azcopy</strong> by extracting the archive file to the home directory or anywhere you like, and add the executable to the <em>PATH</em>. In my example, i have moved the zip file to my $HOME directory and extracted it.
For Linux/MacOS using terminal:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span><span class="nv">$PATH</span>:~/azcopy_darwin_amd64_10.2.1
</code></pre></div></div>

<p><strong>Note</strong>: You can check the path using <em>echo $PATH</em> command.</p>

<p>For Windows using CMD:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pathman /au c:<span class="se">\a</span>zcopy_darwin_amd64_10.2.1
</code></pre></div></div>

<p><strong>Note</strong>: You can check the path using <em>set PATH</em> command. Restart the service if the path is not shown.</p>

<p><strong>Step 3</strong>. Test the installation, by running the <em>azcopy</em> command.</p>

<h2 id="authorize-azcopy-with-azure-and-aws">Authorize AzCopy with Azure and AWS</h2>

<p><strong>Step 4</strong>. First, authorize AzCopy with Azure using the following command:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>azcopy login <span class="nt">--tenant-id</span> &lt;active-directory-tenant-id&gt;
</code></pre></div></div>

<p><strong>Note</strong>: To find the Tenant ID, go to <strong>Azure Active Directory &gt; Properties &gt; Directory ID</strong> in the Azure Portal. Also, donâ€™t forget to assign the <strong>Storage Blob Data Contributor</strong> role to the Azure user.</p>

<p><strong>Step 5</strong>. Open up a web browser, go to the page: <a href="https://microsoft.com/devicelogin" target="_blank">https://microsoft.com/devicelogin</a> and enter the code.<br />
<img src="/assets/images/screenshots/screenshot11.png" alt="Azure device code" /></p>

<p><strong>Step 6</strong>. Next, login with the Azure account. It will display the following message:<br />
<img src="/assets/images/screenshots/screenshot12.png" alt="Azure Storage AzCopy message" /></p>

<p><strong>Step 7</strong>. Configure AWS by setting <em>AWS_ACCESS_KEY_ID</em> and <em>AWS_SECRET_ACCESS_KEY</em> environment variables.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">export </span><span class="nv">AWS_ACCESS_KEY_ID</span><span class="o">=</span>&lt;insert-aws-access-key-id&gt;
<span class="nb">export </span><span class="nv">AWS_SECRET_ACCESS_KEY</span><span class="o">=</span>&lt;insert-aws-secret-access-key-here&gt;
</code></pre></div></div>

<p>Once the authorization is configured, you can try to run the following <strong>azcopy</strong> commands:<br />
<strong>Copy an AWS S3 object to Azure blob</strong></p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>azcopy <span class="nb">cp</span> <span class="s2">"https://s3.amazonaws.com/devcoopsbucket/index.html"</span> <span class="s2">"https://devcoopsstorage.blob.core.windows.net/devcoopscontainer/"</span>
</code></pre></div></div>

<p><strong>Copy an AWS S3 folder to Azure Storage</strong></p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>azcopy <span class="nb">cp</span> <span class="s2">"https://s3.amazonaws.com/devcoopsbucket/folder1"</span> <span class="s2">"https://devcoopsstorage.blob.core.windows.net/devcoopscontainer/folder1 --recursive=true"</span>
</code></pre></div></div>

<p><strong>Copy an AWS S3 bucket to Azure blob storage</strong></p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>azcopy <span class="nb">cp</span> <span class="s2">"https://s3.amazonaws.com/devcoopsbucket"</span> <span class="s2">"https://devcoopsstorage.blob.core.windows.net/devcoopscontainer --recursive=true"</span>
</code></pre></div></div>

<p><strong>Copy all AWS S3 buckets in all regions to Azure Storage</strong></p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>azcopy <span class="nb">cp</span> <span class="s2">"https://s3.amazonaws.com/"</span> <span class="s2">"https://devcoopsstorage.blob.core.windows.net --recursive=true"</span>
</code></pre></div></div>

<p><strong>Copy all AWS S3 buckets in a specific region to Azure Storage</strong></p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>azcopy <span class="nb">cp</span> <span class="s2">"https://s3.eu-west-1.amazonaws.com/"</span> <span class="s2">"https://devcoopsstorage.blob.core.windows.net --recursive=true"</span>
</code></pre></div></div>

<h2 id="conclusion">Conclusion</h2>
<p><strong>AzCopy</strong> is a fast and simple tool, which can also be scheduled as part of backup and/or sync operations.</p>

<p>Official documentation: <a href="https://docs.microsoft.com/en-us/azure/storage/common/storage-use-azcopy-s3" target="_blank">Copy data from Amazon S3 buckets by using AzCopy</a>.</p>
:ET