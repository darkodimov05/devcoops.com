I"ˆ,<p>Wordpress is an open source content management system (CMS) written in PHP and itâ€™s the easiest and most powerful blogging and website CMS in the world. Dockerizing the Wordpress stack will help you to set up a Wordpress stack in just a few minutes instead of installing it from scratch. In this tutorial, we will cover the steps needed for setting up a Wordpress stack using docker-compose.</p>

<h2 id="prerequisites">Prerequisites</h2>
<p>Before continuing with this tutorial you need to met the following prerequisites:</p>

<ul>
  <li>Make sure that you are logged into your Ubuntu machine as a user with <code class="language-plaintext highlighter-rouge">sudo</code> privileges</li>
  <li>Docker installed. You can use the instructions from <a href="https://devcoops.com/install-docker-on-ubuntu-19.04/">How to install docker on Ubuntu 19.04</a></li>
  <li>Docker Compose already installed. Follow the instructions from <a href="https://devcoops.com/install-docker-compose-on-ubuntu-19.04/">How to install Docker Compose on Ubuntu 19.04</a></li>
</ul>

<h2 id="create-the-environment">Create the environment</h2>
<p>Before creating the Docker Compose file we will create a directory which will be used to deploy the application.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">mkdir</span> ~/wordpress
</code></pre></div></div>
<p>Now we will switch to the <code class="language-plaintext highlighter-rouge">wordpress</code> directory and start creating the the stack.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd</span> ~/wordpress
</code></pre></div></div>
<h2 id="configure-the-stack">Configure the Stack</h2>
<p>Once you are into the <code class="language-plaintext highlighter-rouge">wordpress</code> directory, we are ready to create a docker compose file and configure the stack. First we will create the docker compose file:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">touch </span>docker-compose.yml
</code></pre></div></div>
<p>Now open the file and paste the following configuration:</p>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">version</span><span class="pi">:</span> <span class="s1">'</span><span class="s">3.3'</span>

<span class="na">services</span><span class="pi">:</span>
  <span class="na">db</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">mysql:5.7</span>
    <span class="na">container_name</span><span class="pi">:</span> <span class="s">db</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">always</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">db_data:/var/lib/mysql</span>
    <span class="na">env_file</span><span class="pi">:</span> 
      <span class="pi">-</span> <span class="s">.env</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="na">MYSQL_ROOT_PASSWORD</span><span class="pi">:</span> <span class="s">${MYSQL_ROOT_PASSWORD}</span>
      <span class="na">MYSQL_DATABASE</span><span class="pi">:</span> <span class="s">wordpress</span>
      <span class="na">MYSQL_USER</span><span class="pi">:</span> <span class="s">${MYSQL_USER}</span>
      <span class="na">MYSQL_PASSWORD</span><span class="pi">:</span> <span class="s">${MYSQL_PASSWORD}</span>

  <span class="na">wordpress</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">wordpress</span>
    <span class="na">container_name</span><span class="pi">:</span> <span class="s">wordpress</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">always</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">./wp_data:/var/www/html</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">52:80"</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="na">WORDPRESS_DB_HOST</span><span class="pi">:</span> <span class="s">db:3306</span>
      <span class="na">WORDPRESS_DB_NAME</span><span class="pi">:</span> <span class="s">wordpress</span>
      <span class="na">WORDPRESS_DB_USER</span><span class="pi">:</span> <span class="s">${MYSQL_USER}</span>
      <span class="na">WORDPRESS_DB_PASSWORD</span><span class="pi">:</span> <span class="s">${MYSQL_PASSWORD}</span>
    <span class="na">depends_on</span><span class="pi">:</span>
       <span class="pi">-</span> <span class="s">db</span>
  
  <span class="na">phpmyadmin</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">phpmyadmin/phpmyadmin</span>
    <span class="na">container_name</span><span class="pi">:</span> <span class="s">phpmyadmin</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">always</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s1">'</span><span class="s">80:80'</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="na">PMA_HOST</span><span class="pi">:</span> <span class="s">db</span>
      <span class="na">MYSQL_ROOT_PASSWORD</span><span class="pi">:</span> <span class="s">${MYSQL_ROOT_PASSWORD}</span>
    <span class="na">depends_on</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">db</span>
<span class="na">volumes</span><span class="pi">:</span>
    <span class="na">db_data</span><span class="pi">:</span>
</code></pre></div></div>
<p>Now lets explain the <code class="language-plaintext highlighter-rouge">docker compose</code> file step by step:</p>

<ul>
  <li>The first line is showing the Compose file version.</li>
  <li>Next, we are defining three services, <code class="language-plaintext highlighter-rouge">db</code>, <code class="language-plaintext highlighter-rouge">wordpress</code> and <code class="language-plaintext highlighter-rouge">phpmyadmin</code>. We are using phpmyadmin, so you can simply manage your databases.</li>
</ul>

<p>The db service:</p>
<ul>
  <li>We are using <code class="language-plaintext highlighter-rouge">mysql:5.7 image</code>. If the image is not present on the local system it will be pulled from the Docker Hub repo.</li>
  <li>Uses the restart always policy. Whenever the Docker service is restarted, containers using the always policy will be restarted regardless of whether they were running or now.</li>
  <li>Creates persistent volume <code class="language-plaintext highlighter-rouge">dbdata</code>.</li>
  <li>Defines the environment variables for the mysql:5.7 image which will be stored in the <code class="language-plaintext highlighter-rouge">.env</code> file separately.</li>
</ul>

<p>The wordpress service:</p>

<ul>
  <li>Uses the wordpress image.</li>
  <li>Uses the restart always policy. Whenever the Docker service is restarted, containers using the always policy will be restarted regardless of whether they were running or now.</li>
  <li>Mounts the wp_data directory on the host to <code class="language-plaintext highlighter-rouge">/var/www/html</code> inside the container.</li>
  <li>Expose port <code class="language-plaintext highlighter-rouge">80</code> on the container to port <code class="language-plaintext highlighter-rouge">52</code> on the host machine.</li>
  <li>Defines the environment variables for the wordpress image which will be stored in the <code class="language-plaintext highlighter-rouge">.env</code> file separately.</li>
  <li><code class="language-plaintext highlighter-rouge">depends_on</code> instruction is defining the dependency between the two services. So db will be started before wordpress.</li>
</ul>

<p>The phpmyadmin service:</p>
<ul>
  <li>Uses the phpmyadmin image.</li>
  <li>Uses the restart always policy. Whenever the Docker service is restarted, containers using the always policy will be restarted regardless of whether they were running or now.</li>
  <li>Expose port <code class="language-plaintext highlighter-rouge">80</code> on the container to port <code class="language-plaintext highlighter-rouge">80</code> on the host machine.</li>
  <li>Defines the environment variables for the wordpress image which will be stored in the <code class="language-plaintext highlighter-rouge">.env</code> file separately.</li>
  <li><code class="language-plaintext highlighter-rouge">depends_on</code> instruction is defining the dependency between the two services. So db will be started before phpmyadmin.</li>
</ul>

<p>Next, lets create the <code class="language-plaintext highlighter-rouge">env</code> file and store the variables:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">touch</span> .env
</code></pre></div></div>
<p>Open the file and put the following variables:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">MYSQL_ROOT_PASSWORD</span><span class="o">=</span>changethepass
<span class="nv">MYSQL_USER</span><span class="o">=</span>changeuserpass
<span class="nv">MYSQL_PASSWORD</span><span class="o">=</span>passshouldbechanged
</code></pre></div></div>
<p>We successfully configured the stack, next is to deploy and build the images.</p>

<h2 id="deploy-the-stack">Deploy the stack</h2>

<p>To build the docker images execute  the following command:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker-compose up
</code></pre></div></div>
<p>Please note that this command should be executed in the same directory where the <code class="language-plaintext highlighter-rouge">docker compose</code> file is.</p>

<p>Check if the containers are up and running with the following command:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker ps
</code></pre></div></div>
<p>To access the wordpress instance, type in browser:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http://localhost:52 
</code></pre></div></div>
<p>To access the phpmyadmin instance, type in browser:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http://localhost
</code></pre></div></div>
<p>To stop the containers, type the following command:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker-compose stop
</code></pre></div></div>

<p>To remove the containers, type the following command:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker-compose down  
</code></pre></div></div>

<h2 id="conclusion">Conclusion</h2>
<p>In this tutorial we shown you <code class="language-plaintext highlighter-rouge">How to create a Wordpress Stack using Docker Compose</code> and if you have some further questions or information please put a comment in the box below.</p>
:ET